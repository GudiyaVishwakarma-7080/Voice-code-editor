<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice-Enabled Code Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a2e;
            color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            max-width: 900px;
            width: 100%;
            padding: 2rem;
            background-color: #21253c;
            border-radius: 1.5rem;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            margin: 1rem;
        }
        textarea {
            background-color: #2c2f46;
            border-radius: 0.75rem;
            padding: 1rem;
            font-family: monospace;
            color: #a4a8d4;
            outline: none;
            resize: none;
            width: 100%;
            min-height: 250px;
        }
        .output-area {
            background-color: #1f2231;
            border-radius: 0.75rem;
            padding: 1rem;
            min-height: 50px;
            border: 1px solid #4a5078;
            color: #b3f2c5;
            font-family: monospace;
            white-space: pre-wrap;
            overflow-y: auto;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            font-weight: 700;
            color: #ffffff;
            transition: transform 0.2s, background-color 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }
        .btn:hover {
            transform: translateY(-2px);
        }
        .btn-primary {
            background-color: #556ee6;
        }
        .btn-primary:hover {
            background-color: #4a5ccb;
        }
        .btn-secondary {
            background-color: #6c757d;
        }
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #556ee6;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-900 text-white font-inter">

    <div class="container mx-auto p-8 rounded-3xl shadow-xl">
        <div class="text-center mb-6">
            <h1 class="text-4xl font-extrabold text-blue-400 mb-2">Voice-Enabled Code Editor</h1>
            <p class="text-gray-300">Apni aawaz se code likhein aur run karein. Bas bolkar command dein.</p>
            <div id="error-message" class="text-sm mt-4 p-2 rounded-lg text-red-400 bg-red-900 hidden">
                **Error:** Code chalne mein samasya aa rahi hai. Is app ko ek web server par host kiya jaana zaroori hai.
            </div>
        </div>

        <div class="space-y-4">
            <!-- Listening Button and Status -->
            <div class="flex flex-col items-center">
                <button id="startListeningBtn" class="btn btn-primary px-8 py-3 text-lg">
                    <span id="btnText">Sunna Shuru Karein</span>
                </button>
                <div id="listeningStatus" class="mt-2 text-sm text-gray-400"></div>
            </div>

            <!-- User's Prompt Display -->
            <div class="text-center mt-4">
                <p class="text-lg font-semibold text-gray-200">Aapne bola:</p>
                <div id="userPrompt" class="bg-gray-800 text-gray-200 p-4 rounded-lg mt-2"></div>
            </div>

            <!-- Code Editor -->
            <div class="mt-6">
                <p class="text-lg font-semibold text-gray-200 mb-2">Code Editor:</p>
                <textarea id="codeEditor" class="w-full bg-gray-800 text-green-300 p-4 rounded-xl border border-gray-700"></textarea>
            </div>
            
            <!-- Loading and Run Buttons -->
            <div class="flex items-center gap-4">
                <button id="runCodeBtn" class="btn btn-primary w-full px-8 py-3 text-lg">Code Chalaayein</button>
                <div id="loadingIndicator" class="hidden loading-spinner"></div>
            </div>

            <!-- Output Area -->
            <div class="mt-6">
                <p class="text-lg font-semibold text-gray-200 mb-2">Output:</p>
                <div id="output" class="bg-gray-800 text-gray-300 p-4 rounded-xl border border-gray-700 min-h-[50px]"></div>
            </div>
        </div>
    </div>

    <script type="module">
        const apiKey = "";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        const startListeningBtn = document.getElementById('startListeningBtn');
        const btnText = document.getElementById('btnText');
        const listeningStatus = document.getElementById('listeningStatus');
        const userPromptDiv = document.getElementById('userPrompt');
        const codeEditor = document.getElementById('codeEditor');
        const runCodeBtn = document.getElementById('runCodeBtn');
        const outputDiv = document.getElementById('output');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const errorMessageDiv = document.getElementById('error-message');

        // Check for local file execution and display a warning
        if (window.location.protocol === 'file:') {
            errorMessageDiv.classList.remove('hidden');
        }

        if (!('webkitSpeechRecognition' in window)) {
            listeningStatus.textContent = "Maaf kijiye, aapka browser voice recognition ko support nahi karta.";
            startListeningBtn.disabled = true;
        }

        const recognition = new webkitSpeechRecognition();
        recognition.lang = 'hi-IN'; // Hindi mein aawaz pehchan ke liye
        recognition.interimResults = false;
        recognition.continuous = false;

        let isListening = false;

        recognition.onstart = () => {
            isListening = true;
            btnText.textContent = 'Sun raha hoon...';
            listeningStatus.textContent = 'Bolna shuru karein...';
            startListeningBtn.disabled = true;
        };

        recognition.onend = () => {
            isListening = false;
            btnText.textContent = 'Sunna Shuru Karein';
            listeningStatus.textContent = '';
            startListeningBtn.disabled = false;
        };

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            userPromptDiv.textContent = transcript;
            generateCode(transcript);
        };

        recognition.onerror = (event) => {
            listeningStatus.textContent = `Aawaz pehchan mein error: ${event.error}`;
            console.error('Speech Recognition Error:', event.error);
        };

        startListeningBtn.addEventListener('click', () => {
            if (!isListening) {
                recognition.start();
            }
        });

        async function generateCode(prompt) {
            loadingIndicator.classList.remove('hidden');
            outputDiv.textContent = 'Code generate ho raha hai...';
            codeEditor.value = '';

            const systemPrompt = "Aap ek expert programmer hain. Aapko alag alag programming languages mein code likhna hai. Jab aapko koi command diya jaye, to aapko sirf aur sirf ek poora aur chalne wala code likhna hai. Code ke alawa kuch aur mat likhna. Koi comments, explanations ya extra text nahi. Code mein `console.log` ya `print` statement shamil karein taki nateeja dikhe. Agar koi bhasha batayi na jaye, to JavaScript mein code likhein.";
            
            const userQuery = `"${prompt}". Is command ke liye poora, chalne wala aur achcha format kiya hua code likhein.`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                }
            };

            try {
                let response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                const generatedCode = result?.candidates?.[0]?.content?.parts?.[0]?.text;

                if (generatedCode) {
                    codeEditor.value = generatedCode;
                    outputDiv.textContent = 'Code safaltapoorvak generate ho gaya. "Code Chalaayein" par click karke dekhein.';
                } else {
                    outputDiv.textContent = 'Code generate nahi ho paya. Dobara koshish karein.';
                }
            } catch (error) {
                console.error('Code generate karte samay error:', error);
                outputDiv.textContent = `Error: ${error.message}. Is app ko online chalaana zaroori hai.`;
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        }

        runCodeBtn.addEventListener('click', () => {
            const codeToRun = codeEditor.value;
            if (!codeToRun) {
                outputDiv.textContent = "Pehle code generate karein.";
                return;
            }
            
            const originalConsoleLog = console.log;
            let output = '';
            console.log = (...args) => {
                output += args.map(arg => {
                    if (typeof arg === 'object') {
                        return JSON.stringify(arg, null, 2);
                    }
                    return String(arg);
                }).join(' ') + '\n';
            };

            try {
                // Yahan check karen ki code kis bhasha ka hai.
                if (codeToRun.includes('def ') || codeToRun.includes('import ') || codeToRun.includes('class ') || codeToRun.includes('public static void main')) {
                    outputDiv.textContent = "Maaf kijiye, yah code JavaScript ke alawa kisi aur bhasha ka hai. Yah editor sirf JavaScript code chala sakta hai. Aap is code ko copy kar sakte hain.";
                } else {
                    // Yahan hum code ko surakshit roop se chala rahe hain.
                    (new Function(codeToRun))();
                    outputDiv.textContent = output || 'Code safaltapoorvak chal gaya. Koi output nahi hai.';
                }
            } catch (error) {
                outputDiv.textContent = `Code mein error: ${error.message}`;
            } finally {
                console.log = originalConsoleLog;
            }
        });

        codeEditor.value = `// Bolne ke liye "Sunna Shuru Karein" button par click karein.
// Udaharan: "Python mein factorial ka code likho" ya "JavaScript mein array reverse karne ka code likho"`;
    </script>
</body>
</html>
